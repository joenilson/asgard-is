<script>
<?php
if(!empty($this->role)){
  $var=str_replace(' ','',$this->role);
  //echo "Ext.require('Asgard.lib.toolbar{$var}');\n";
  echo "var panelVersioning = '".$this->panelVersioning."';\n";
  echo "var panelContent = '".$this->panelContent."';\n";
  echo "var emptyContent = '".$this->message."'\n";
  //echo "var panelContent = '';\n";
  echo "var toolbarType = '".$var."-toolbar';\n";
}
?>
Ext.tip.QuickTipManager.init();

var originalItems = [{ xtype: 'container', anchor: '100%', html: panelVersioning+panelContent+emptyContent }];

var Panel = Ext.create('Asgard.lib.RTFPanel', {
  dockedItems: {
    xtype: toolbarType
  },
  url: '/ims/saveContent/<?php echo $this->contentId; ?>',
  autoShow: true,
  autoDestroy: true,
  frame: false,
  layout: 'anchor',
  items: originalItems
});

function onClick(btn){
    //console.log(btn);
    switch (btn.text){
        case "Search":
            console.log('Search lib class to be implemented.');
            break;
        case "Edit Content":
            Panel.removeAll();
            var items = [
                { 
                    xtype: 'rb-versioning'
                },
                { 
                    xtype: 'rtfeditor', name: 'rtfeditor', value: panelContent, height: '90%', anchor: '100%'
                }];
            Panel.add(items);
            Panel.doLayout();
            break;
        case "Add Content":
            console.log('Add lib class to be implemented.');
            break;
        case "Remove Content":
            console.log('Remove lib class to be implemented.');
            break;
        case "Save Changes":
            var editedContent = Panel.items.items[0].value;
            console.log(editedContent);
            if (editedContent !== panelContent){
                Panel.form.submit({
                    success: function(form, action) {
                       Ext.Msg.alert('Success', action.result.msg);
                    },
                    failure: function(form, action) {
                        Ext.Msg.alert('Failed', action.result.msg);
                    }
                });
                console.log('Has been made changes');
            }else{
                Panel.removeAll();
                Panel.add(originalItems);
                console.log('No changes to commit');
                Panel.doLayout();
            }
            console.log('Save lib class to be implemented.');
            break;
        case "Cancel Changes":
            Panel.removeAll();
            Panel.add(originalItems);
            Panel.doLayout();
            break;
        default:
            console.log('At this point we will do nothing.');
            break;
    }
}
Ext.getCmp('content-panel').getActiveTab().add(Panel);
</script>