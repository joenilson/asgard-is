<script>
<?php
if(!empty($this->role)){
  $var=str_replace(' ','',$this->role);
  echo "var panelVersioning".$this->panelId." = '".$this->panelVersioning."';\n";
  echo "var panelContent".$this->panelId." = '".$this->panelContent."';\n";
  echo "var emptyContent".$this->panelId." = '".$this->message."';\n";
  echo "var toolbarType".$this->panelId." = '".$var."-toolbar';\n";
}
?>
Ext.tip.QuickTipManager.init();
var objectivesStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.Objectives');
var requirementsStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.Requirements');
var viewStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.Organigram');
var ownersStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.OwnersProfile');
var commStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.Communications');
var tpStore<?= $this->panelId; ?> = new Ext.create('Asgard.store.TrainingPlan');

function showObjetives(){
    var view<?=$this->panelId;?> = Ext.create('Asgard.lib.dataview.objectives', { 
        store: objectivesStore<?= $this->panelId; ?>, 
    });
    var contentObj<?=$this->panelId; ?> = Ext.create('Ext.panel.Panel',{
        flex: 1,
        layout: 'fit',
        items: view<?=$this->panelId;?>
    });
    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550
    });
    winAdd.setTitle('Objectives');
    winAdd.add(contentObj<?=$this->panelId;?>);
    winAdd.show();
    objectivesStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

function showRequirements(){
    var requirementsgrid<?=$this->panelId;?> = Ext.create('Asgard.lib.grid.requirements', { 
        store: requirementsStore<?= $this->panelId; ?>, 
        id: 'reqgrid<?=$this->panelId;?>'
    });
    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550,
    });
    winAdd.setTitle('Requirements');
    winAdd.add(requirementsgrid<?=$this->panelId;?>);
    winAdd.show();
    requirementsStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

function showOrganigram(){
    var view<?=$this->panelId;?> = Ext.create('Asgard.lib.dataview.organigram', { 
        store: viewStore<?= $this->panelId; ?>, 
    });
    var contentOrg<?=$this->panelId; ?> = Ext.create('Ext.panel.Panel',{
        flex: 1,
        layout: 'fit',
        items: view<?=$this->panelId;?>
    });

    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550,
    });
    winAdd.setTitle('Organigram');
    winAdd.add(contentOrg<?=$this->panelId;?>);
    winAdd.show();
    viewStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

function showOwnersProfiles(){
    var ownersgrid<?=$this->panelId;?> = Ext.create('Asgard.lib.grid.ownersprofile', { 
        store: ownersStore<?= $this->panelId; ?>, 
        id: 'ownersgrid<?=$this->panelId;?>'
    });

    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550,
    });
    winAdd.setTitle('Owners Profile');
    winAdd.add(ownersgrid<?=$this->panelId;?>);
    winAdd.show();
    ownersStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

function showCommunications(){
    var commgrid<?=$this->panelId;?> = Ext.create('Asgard.lib.grid.communications', { 
        store: commStore<?= $this->panelId; ?>, 
        id: 'commgrid<?=$this->panelId;?>'
    });

    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550,
    });
    winAdd.setTitle('Communications');
    winAdd.add(commgrid<?=$this->panelId;?>);
    winAdd.show();
    commStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

function showTrainingPlan(){
    var tpgrid<?=$this->panelId;?> = Ext.create('Asgard.lib.grid.trainingplan', { 
        store: tpStore<?= $this->panelId; ?>, 
        id: 'tpgrid<?=$this->panelId;?>'
    });

    var winAdd = Ext.create('Asgard.lib.window.windowGeneric',{
        height: document.documentElement.clientHeight - 50,
        width: document.documentElement.clientWidth - 550,
    });
    winAdd.setTitle('Training Plan');
    winAdd.add(tpgrid<?=$this->panelId;?>);
    winAdd.show();
    tpStore<?= $this->panelId; ?>.load({ params: { module: 'master', company: '<?=$companyId;?>', country: '<?=$countryId;?>', location: '<?=$locationId;?>'  }});
}

var versioningHeader<?php echo $this->panelId; ?> = Ext.create('Asgard.lib.versioningContent',{
    anchor: '100%',
    versionField: {
        value: "<?php echo $this->versioningContent; ?>"
    },
    validField: {
        value: "<?php echo $this->versioningDate; ?>"
    },
    scopeField: {
        value: "<?php echo $this->documentScope; ?>"
    }
});
var oItems<?php echo $this->panelId; ?> = Ext.String.htmlDecode(panelContent<?php echo $this->panelId; ?>);
var originalItems<?php echo $this->panelId; ?> = [{ 
        xtype: 'container',
        anchor: '100%',
        name: 'dataContainer',
        html: oItems<?php echo $this->panelId; ?>+emptyContent<?php echo $this->panelId; ?>
    }];

var <?php echo 'Panel'.$this->panelId; ?> = Ext.create('Asgard.lib.RTFPanel', {
  dockedItems: [{
    xtype: toolbarType<?php echo $this->panelId; ?>
  }, versioningHeader<?php echo $this->panelId; ?>],
  url: 'ims/saveContent/<?php echo $this->contentId; ?>',
  autoShow: true,
  autoDestroy: true,
  autoScroll: true,
  border: false,
  frame: false,
  layout: 'anchor',
  items: originalItems<?php echo $this->panelId; ?>
});

function onClick(btn){
    var tbar<?php echo $this->panelId; ?> = <?php echo 'Panel'.$this->panelId; ?>.getDockedItems('toolbar[dock="top"]')[0];
    switch (btn.name){
        case "search":
            console.log('Search lib class to be implemented.');
            break;
        case "edit":
            tbar<?php echo $this->panelId; ?>.down('#save').setDisabled(false);
            tbar<?php echo $this->panelId; ?>.down('#cancel').setDisabled(false);
            tbar<?php echo $this->panelId; ?>.down('#edit').setDisabled(true);
            
            <?php echo 'Panel'.$this->panelId; ?>.removeAll();
            var items = [
                {
                    xtype: 'rb-versioning'
                },
                {
                    xtype: 'rb-scope'
                },
                { 
                    xtype: 'rtfeditor', name: 'rtfeditor', value: panelContent<?php echo $this->panelId; ?>, height: '95%', anchor: '100%'
                }];
            <?php echo 'Panel'.$this->panelId; ?>.add(items);
            <?php echo 'Panel'.$this->panelId; ?>.doLayout();
            break;
        case "add":
            console.log('Add lib class to be implemented.');
            break;
        case "remove":
            console.log('Remove lib class to be implemented.');
            break;
        case "save":
            
            tbar<?php echo $this->panelId; ?>.down('#save').setDisabled(true);
            tbar<?php echo $this->panelId; ?>.down('#cancel').setDisabled(true);
            tbar<?php echo $this->panelId; ?>.down('#edit').setDisabled(false);
            
            var editedContent = <?php echo 'Panel'.$this->panelId; ?>.items.items[2].value;
            if (editedContent !== panelContent<?php echo $this->panelId; ?>){
                console.log('changes detected');
                <?php echo 'Panel'.$this->panelId; ?>.form.submit({
                    params: {
                        content_versioning: '<?php echo $this->versioningContent; ?>'
                    },
                    success: function(form, action) {
                        Ext.getCmp('content-panel').getActiveTab().removeAll();
                        Ext.getCmp('content-panel').getActiveTab().getLoader().load();
                    },
                    failure: function(form, action) {
                        Ext.Msg.alert('Failed', action.msg);
                    }
                });
            }else{
                console.log('no changes detected');
                <?php echo 'Panel'.$this->panelId; ?>.removeAll();
                <?php echo 'Panel'.$this->panelId; ?>.add(originalItems<?php echo $this->panelId; ?>);
                <?php echo 'Panel'.$this->panelId; ?>.doLayout();
            }
            break;
        case "cancel":
            tbar<?php echo $this->panelId; ?>.down('#save').setDisabled(true);
            tbar<?php echo $this->panelId; ?>.down('#cancel').setDisabled(true);
            tbar<?php echo $this->panelId; ?>.down('#edit').setDisabled(false);

            <?php echo 'Panel'.$this->panelId; ?>.removeAll();
            <?php echo 'Panel'.$this->panelId; ?>.add(originalItems<?php echo $this->panelId; ?>);
            <?php echo 'Panel'.$this->panelId; ?>.doLayout();
            break;
        default:
            
            break;
    }
}
Ext.getCmp('content-panel').getActiveTab().add(<?php echo 'Panel'.$this->panelId; ?>);
</script>