<?php
/**
 * @application Asgard Information System :: asgard-is
 * @version 1.0.0 devel
 * @author Joe Nilson <joenilson@gmail.com>
 */
?>
<script>
<?php
/*
if(!empty($this->userRole)){
    $var=str_replace(' ','',$this->userRole);
    echo "var toolbarType".$this->panelId." = Ext.create('Asgard.lib.gridToolbar".$var."',{titleBarText: '<b>".$this->HiraGridTitle."</b>'});\n";
}
*/
?>
/**
* Custom function used for column renderer
* @param {Object} val
*/
/*
function riskleveler(val, meta) {
    if (val < 9 && val > 0) {
        meta.tdCls = 'red-column';
    } else if (val < 16 && val > 8) {
        meta.tdCls = 'yellow-column';
    } else if (val > 15) {
        meta.tdCls = 'green-column';
    }
    return val;
}
*/
var <?php echo 'rowEditing'.$this->panelId; ?> = Ext.create('Ext.grid.plugin.RowEditing', {
    clicksToMoveEditor: 1,
    autoCancel: false
});

function deployCombos(comboField,comboValue){
    var combo = formDataRequest<?=$this->panelId;?>.getForm().findField(comboField);
    var store = combo.store;
    store.on("load", function(store, records, state, operation, opts) {
            combo.setValue(comboValue);
    });
}

var HIRAStore<?=$this->panelId; ?> = Ext.create('Asgard.store.HiraDocuments');
<?php 
//echo 'HIRAStore'.$this->panelId.'.load();'; 
?>

var formDataRequest<?=$this->panelId; ?> = Ext.create('Asgard.lib.forms.comboCCLP',{
    region: 'north'
});

var HIRAGridPanel<?=$this->panelId; ?> = Ext.create('Asgard.lib.grid.hira_general',{
    store: HIRAStore<?=$this->panelId; ?>,
    region: 'center'
});
<?php
/*
if ($this->userRole!='Viewer'){
    echo 'rowEditing'.$this->panelId.".init(HIRAGridPanel".$this->panelId.");\n\r";
    echo "HIRAGridPanel".$this->panelId.".plugins.push(rowEditing".$this->panelId.");\n\r";
}
 * */
 ?>
    
function fnCCLPProcess(button, opt, obj) {
    var values = button.up('form').getForm().getValues();
    var companies = values['companiesCombo'];
    var countries = values['countriesCombo'];
    var locations = values['locationsCombo'];
    var process_id = values['processCombo'];
    HIRAStore<?= $this->panelId; ?>.removeAll();
    HIRAStore<?= $this->panelId; ?>.load({ params: { module: 'hira', company: companies, country: countries, location: locations, process: process_id }});

}
/*
var HiraSpecs<?=$this->panelId; ?> = Ext.create('Ext.Panel', {
    collapsible: true,
    frame: false,
    region: 'south',
    titleAlign: 'right',
    collapsed: true,
    title: '<?php echo $this->titleHiraSpecs; ?>',
    loader: {
        url: 'ims/hiraspecs/<?php echo $this->moduleId; ?>',
        autoLoad: true,
        scripts: true
    }
});
*/
var <?php echo 'HiraPanel'.$this->panelId; ?> = Ext.create('Ext.Panel', {
    frame: false,
    layout: 'border',
    items: [ 
        formDataRequest<?=$this->panelId; ?>,
        HIRAGridPanel<?=$this->panelId; ?>
    ]
});

deployCombos('companiesCombo','<?=$this->companyId;?>');
deployCombos('countriesCombo','<?=$this->countryId;?>');
deployCombos('locationsCombo','<?=$this->locationId;?>');


Ext.getCmp('content-panel').getActiveTab().add(<?php echo 'HiraPanel'.$this->panelId; ?>);
</script>